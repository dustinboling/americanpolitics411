<% @page_title = "#{@person.first_last_name}" %>
<%= javascript_include_tag "mapper/mapper.js" %>

<%# push necessary data to DOM %>
<script>
  window.pid = "<%= @person.id %>";
  window.nytid = "<%= @person.bioguide_id %>";
  <% unless @person.photo_url.blank? %>
    <% if @person.photo_url.to_s.match(/govtrack/) || @person.photo_url.to_s.match(/pagodabox/)%>
      <% photo_url_ary = @person.photo_url.to_s.split(/http:/) %>
      <% photo_url = photo_url_ary[1] %>
      window.photo_url = "<%= photo_url %>";
    <% else %>
      window.photo_url = "<%= @person.photo_url.thumb %>";
    <% end %>
  <% end %>
  <% if @person.title.blank? %>
    window.full_name = "<%= @person.first_name + " " + @person.last_name %>";
  <% else %>
    window.full_name = "<%= @person.title + " " + @person.first_name + " " + @person.last_name %>";
  <% end %>
  window.current_party = "<%= @person.current_party %>";
  window.state_represented = "<%= @person.state_represented %>";
  window.district = "<%= @person.district %>";
  window.birthplace = "<%= @person.birthplace %>";
  window.birthdate = "<%= @person.date_of_birth %>";
  window.religion = "<%= @person.religion.name %>";
  window.twitter_id = "<%= @person.twitter_id %>";
  window.congressmember = "<%= @person.is_congress_member %>";
  window.chamber = "<%= @person.chamber %>";
  window.star = '<%= asset_path("silver-star-15px.png") %>';
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>

<div class="sixteen columns">
  <div id="bubble-map"></div>
  <div id="follow-button" style="display: none;">
    <% unless @person.twitter_id.nil? %>
    <a href="https://twitter.com/<%= @person.twitter_id %>" class="twitter-follow-button" data-show-count="false">Follow @<%= @person.twitter_id %></a>
    <% end %>
  </div>
  <div id="popup-text">
  </div>
  <div id="current-tweet">
  </div>
  <div id="media-center-separator">
    <div id="print-header" class="four columns">
      <h4><a href="<%= articles_person_path(@person) %>">Print Media <span class="red">>></span></a></h4>
    </div>
    <div id="media-center-header" class="four columns">
      <h4>Media Center</h4>
    </div>
    <div id="video-media-header" class="four columns">
      <h4><a href="<%= videos_person_path(@person) %>">Video Media <span class="red">>></span></a></h4>
    </div>
  </div>
  <div id="media-center" class="sixteen columns">
    <div id="media-center-articles" class="eight columns">
      <% if @articles.nil? || @articles['articles'].length == 0 %>
        <% feed_articles = parse_google_rss_feed(@person.first_last_name) %>
        <% unless feed_articles == 0 %>
          <% n = 0 %>
          <% z = 0 %>
          <% while n < feed_articles.count %>
            <div class="article">
              <% title = feed_articles[z].title.split(/ - /)[0] %>
              <% url = feed_articles[z].url.split("http://")[2].prepend("http://") %>
              <% summary = parse_google_summary(feed_articles[z].summary) %>
              <h4><%= link_to title, url, :target => "_blank" %></h4>
              <p>
                <%= truncate(summary, :length => 120) %><br>
                <%= link_to " Read More >", url, {:style => "color:red;"}, :target => "_blank" %>
              </p>
            </div>
            <% n = n + 1 %>
            <% z = z + 1 %>
          <% end %>
        <% end %>
        <br>
        <%= link_to "More Articles >>", articles_person_path(@person), :id => 'more-articles-link' %>
      <% else %>
        <% @articles = @articles['articles'] %>
        <% i = 1 %>
        <% count = @articles.take(8).count %>
        <% @articles.take(8).each do |a| %>
          <% article = a[1] %>
          <% if i == 1 %>
            <div class="article">
            <% else %>
            <div class="article">
            <% end %>
              <h4><%= link_to article['post_title'], article['guid'].gsub(/#038;/, ""), :target => "_blank" %></h4>
              <p>
                <%= truncate(article['post_excerpt'], :length => 120) %><br>
                <%= link_to " Read More >", article['guid'].gsub(/#038;/, ""), {:style => "color:red;"}, :target => "_blank" %>
              </p>
            </div>
            <% i = i + 1 %>
        <% end %>
        <% if count < 10 %>
          <% feed_articles = parse_google_rss_feed(@person.first_last_name) %>
          <% n = count %>
          <% z = 0 %>
          <% while n < 10 %>
            <div class="article">
              <% title = feed_articles[z].title.split(/ - /)[0] %>
              <% url = feed_articles[z].url.split("http://")[2].prepend("http://") %>
              <% summary = parse_google_summary(feed_articles[z].summary) %>
              <h4><%= link_to title, url, :target => "_blank" %></h4>
              <p>
                <%= truncate(summary, :length => 120) %>
                <%= link_to " Read More >", url, {:style => "color:red;"}, :target => "_blank" %>
              </p>
            </div>
            <% n = n + 1 %>
            <% z = z + 1 %>
          <% end %>
        <% end %>
        <%= link_to "More Articles >>", articles_person_path(@person), :id => 'more-articles-link' %>
      <% end %>
    </div>
    <div id="media-center-videos" class="seven columns">
      <%= render :partial => 'media' %>
    </div>
  </div>
</div>
