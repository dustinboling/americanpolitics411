<% 
  @person = Person.find(params[:pid])
  @entity = TransparencyData::Client.entities(:search => "#{@person.remove_name_numericality}")
  if @entity.first
    @id = @entity.first.id
    @sectors = TransparencyData::Client.top_sectors(@id)
  else
    @sectors = []
  end
%>

<h1>Demographics & Endorsements</h1>
<% if @sectors.count > 0 %>
<table class="table-striped" style="width: 920px;">
  <thead>
    <tr>
      <th>Name</th>				
      <th>Percent</th>
      <th>Total Amount</th>
    </tr>
  </thead>
  <tbody>
    <% contributions_by_sector_math %>
    <% @sectors.collect do |s| %>
    <tr>
      <td><%= s.name %></td>
      <td><%= sprintf("%0.02f", ((s.amount.to_f / @i.to_f)) * 100) %></td>
      <td><%= number_to_currency(s.amount) %></td>
    </tr>
    <% end %>
    <tr>
      <td></td>
      <td><h4>Total:</h4></h4></td>
    <td><h4><%= number_to_currency(@i) %></h4></td>
  </tbody>
</table>
<p class="attribution">SOURCE: <a href="http://www.opensecrets.org">OpenSecrets.org</a></p>
<% else %>
Information is not currently available, research is in progress.
<% end %>
